---
import { Picture } from "@astrojs/image/components";
import papers from "../../data/papers.json";
import Layout from "../../layouts/Layout.astro";

const { slug } = Astro.params,
  paper = papers.find((paper) => paper.slug === slug);

export function getStaticPaths() {
  return papers.map((paper) => {
    return { params: { slug: paper.slug } };
  });
}

const imageImports = import.meta.glob("../../images/articles/*.png", {
  eager: true,
});

const imageKey = Object.keys(imageImports).find((image) => {
  return image.indexOf(paper?.id || "") !== -1 ? paper?.id : "";
});
const image = imageImports[imageKey].default;
---

<Layout>
  <h2>{paper?.title}</h2>

  {
    image && (
      <Picture
        class="image"
        src={image}
        alt={paper?.prompt ?? ""}
        title={paper?.prompt ?? ""}
        sizes="(max-width: 1023px) calc(100vw - 40px), (min-width:1044px) 1024px"
        widths={[350, 500, 700, 768, 1000, 1024, 1400, 1536, 2048]}
        formats={["jpeg", "webp"]}
      />
    )
  }

  <p class="intro">{paper?.intro}</p>

  <div class="text">
    {
      paper?.text.split("\n\n").map((paragraph) => {
        return <p class="paragraph">{paragraph}</p>;
      })
    }
  </div>

  <p class="credit">
    Original paper: <a href={paper?.link}>{paper.link}</a>
  </p>

  <style>
    img {
      width: 100%;
      aspect-ratio: 16/9;
      object-fit: cover;
    }

    .intro {
      font-size: 24px;
    }

    .text {
      column-width: 500px;
      column-gap: 40px;
    }

    .credit {
      margin: 40px 0;
    }
  </style>
</Layout>
